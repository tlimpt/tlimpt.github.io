<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="noindex">
<title>Grémio de Finanças Pessoais — Aveiro</title>
<style>
body { max-width:60ch; padding:.5em; margin:0 auto; line-height:1.75; font-size:1.25em; opacity:.9 }
header p { border-bottom:.3em solid; margin:0 0 2em; padding:.5em 0 }
h1, h2, h3 { line-height:1 }
h1 { font-size:2em }

aside { border-left:.3em solid; padding:0 0 0 2em; margin:2em 0 }
blockquote { font-style:italic }
table { border-collapse:collapse; margin:2em auto; font-size:.8em }
table caption strong:first-child, figcaption strong:first-child { display:block }
figure { text-align:center; margin:2em 0; font-size:.8em; }
thead { border-bottom:.3em solid }
td { border-bottom:.1em solid; padding:1em .5em 1em 0; text-align:center; line-height:1.25em; vertical-align:top }
td:first-child { text-align:left }
td:last-child { padding:1em 0 }
input { font-family:inherit; font-size:1em; width:5em; text-align:right; border-width:0 0 .2em; background:none; color:inherit; outline:none }
button { font-size:.8em }
</style>
<script>
function n(el, dig) {
	var input1 = document.getElementById(el).value.replace(/[^\d]/g, '') / (10 ** dig);
	var input2 = input1.toLocaleString('pt-PT', {minimumFractionDigits:dig, maximumFractionDigits:dig});
	document.getElementById(el).value = input2;
	return input1; }

function e(el, n, dig) { document.getElementById(el).innerHTML = n.toLocaleString('pt-PT', {minimumFractionDigits:dig, maximumFractionDigits:dig}); }

function i(el, n) { document.getElementById(el).value = n; }
</script>
</head>
<body>
<p id="simula">
<strong>Preço</strong>: <input type="text" value="71,225" style="width:4em" id="preco" onkeyup="h();">€<br>
<strong>Em dívida</strong>: <span id="divida">0</span>€<br>

<strong>Fase 1</strong>:
<span id="inicio">0</span>€ & 
<select style="font-size:.8em" id="aplica-resgata1"><option value="1" selected>aplicar<option value="-1">alienar</select>
<input type="text" value="0" style="width:3em" id="periodico1" onkeyup="h();">€/mês & 
<input type="text" value="8" style="width:2em" id="anos1" onkeyup="h();"> anos<br>

<strong>Fase 2</strong>:
<select style="font-size:.8em" id="aplica-resgata2"><option value="1">aplicar<option value="-1" selected>alienar</select>
<input type="text" value="900" style="width:3em" id="periodico2" onkeyup="h();">€/mês & 
<input type="text" value="14" style="width:2em" id="anos2" onkeyup="h();"> anos<br>

<strong>Fase 3</strong>:
<select style="font-size:.8em" id="aplica-resgata3"><option value="1">aplicar<option value="-1" selected>alienar</select>
<input type="text" value="120" style="width:3em" id="periodico3" onkeyup="h();">€/mês & 
<input type="text" value="20" style="width:2em" id="anos3" onkeyup="h();"> anos<br>


<script src="shiller.js"></script>
<script>
function h(x) {
//	console.clear();

	var unidades = window.location.href.split("?")[1] * 1;
	var preco = x; // n('preco', 3);
	
	var divida = 49800;
	divida = divida + Math.round((new Date()-new Date(2023,1,8))/(24*60*60*1000)-1) / 365 * 1.66 /100 * divida;
	e('divida', divida, 2);

	var inicio = unidades * preco - divida;

	e('inicio', inicio, 0);

	var periodico1 = n('periodico1', 0) * document.getElementById('aplica-resgata1').value;
	var anos1 = n('anos1', 0);
	var m1 = 12 * anos1;

	var periodico2 = n('periodico2', 0) * document.getElementById('aplica-resgata2').value;
	var anos2 = n('anos2', 0);
	var m2 = 12 * anos2;

	var periodico3 = n('periodico3', 0) * document.getElementById('aplica-resgata3').value;
	var anos3 = n('anos3', 0);
	var m3 = 12 * anos3;

	var m = m1 + m2 + m3;


	var patrimonios = [];
	for (var g = 0; g < shiller.length - m; g++) {
		var i = shiller.slice(0 + g, m + g);
		var patrimonio = [];
		patrimonio.push(inicio);
		for (var a = 0; a < m1; a++) {
			if (patrimonio[a] < 0) { patrimonio.push(0); }
			else {
				if (patrimonio[a] * (1 + i[a]/100 ) + periodico1 < 0 ) { patrimonio.push(0); }
				else { patrimonio.push(patrimonio[a] * (1 + i[a]/100 ) + periodico1); }
			}
		}
		for (var a = m1; a < m1 + m2; a++) {
			if (patrimonio[a] < 0) { patrimonio.push(0); }
			else {
				if (patrimonio[a] * (1 + i[a]/100) + periodico2 < 0 ) { patrimonio.push(0); }
				else { patrimonio.push(patrimonio[a] * (1 + i[a]/100) + periodico2); }
			}
		}
		for (var a = m1 + m2; a < m1 + m2 + m3; a++) {
			if (patrimonio[a] < 0) { patrimonio.push(0); }
			else {
				if (patrimonio[a] * (1 + i[a]/100) + periodico3 < 0 ) { patrimonio.push(0); }
				else { patrimonio.push(patrimonio[a] * (1 + i[a]/100) + periodico3); }
			}
		}

			patrimonios.push(patrimonio);
	}


	var final = [];
	for (var g = 0; g < patrimonios.length; g++) {
		final.push(patrimonios[g][patrimonios[g].length - 1]);
//		console.log(g + ": " + Math.round(patrimonios[g][patrimonios[g].length - 1]));
	}

	var pneg = 0;
	for (var w = 0; w < final.length; w++){ if (final[w] == 0) pneg++; }
	pneg = pneg / final.length * 100;
	e('resumo',100 - pneg,0);


//	console.log("Simulações: " + final.length + " (~" + Math.round(final.length / 12) + " anos)");
}

function yf() {
const url = 'https://query2.finance.yahoo.com/v10/finance/quoteSummary/iwda.as?modules=price';

const response = UrlFetchApp.fetch(url, { muteHttpExceptions: true });
const responseCode = response.getResponseCode();
if (responseCode === 200) {
	const quote = JSON.parse(response.getContentText());
	var pp = quote.quoteSummary.result[0].price.regularMarketPrice.raw;
	h(pp);
  }

}

window.onload = (event) => { yf(); };
</script>

<p>Taxa de sucesso: <span id="resumo">0</span>%.

</body>
</html>
